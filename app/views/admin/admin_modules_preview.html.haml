- content_for :title, "Module Preview"

.container.body_whole_custom
  .container-fluid.bg_none.text_black.margin_top.bigger
    #{@module_info.name} - #{@module_info.code}
    %button.float_right.no_padding.btn.btn-primary.agreement_buttons.justify-content-center.button_go_back_1.medium.button_small{onclick: "location.href='/admin/modules';", type: "button"} Go Back
    %hr.group_line
  .container-fluid.bg_none.text_black
    #{@module_info.description}
    %hr.group_line
  .container-fluid.bg_none
    .container-fluid.bg_none.row.no_padding
      .container-fluid.bg_none.text_black.col-xs-9.col-sm-6.no_padding_right.no_padding.margin_top_none
        %strong
          Module Leader:
        %br
        %ul
          %li
            - if @module_leader != nil
              #{@module_leader.givenname} #{@module_leader.sn}
      .container-fluid.bg_none.text_black.col-xs-9.col-sm-6.no_padding_left.no_padding.margin_top_none
        %strong
          Teaching assistants:
        %br
        %ul
          - for i in 0..(@teaching_assistants.length-1)
            %li
              #{@teaching_assistants[i].givenname} #{@teaching_assistants[i].sn}
    %hr.group_line
    .container-fluid.bg_none.no_padding.bg_border.margin_bottom_small.bg_white.no_border
      = simple_form_for :search_form do |f|
        .container-fluid.bg_none.no_padding
          %img.search_logo.margin_none{:src => "/assets/search_logo.jpg", :alt => "Search Users"}
        .container-fluid.bg_none.row.no_padding.margin_bottom_none  
          = f.input :form_module_id, :as => :hidden, :input_html => {:id => "form_module_id", :value => params[:module_id] }
          .container.col-xs-6.col-sm-5.no_padding_right.no_padding_left
            = f.input :search_input, as: :string, label: false , required: false
          .container.col-xs-4.col-sm-3.no_padding_left
            = f.button :submit, "Search", name:"search_button", class: "btn btn-primary agreement_buttons justify-content-center button_search_2 float_left", id:"submit_choice"
          .container.col-xs-8.col-sm-4.no_padding_left.no_padding_right.padding_right_small
            %button{onclick: "window.open('/module_handbook','Handbook','toolbar=no,location=no,status=no,menubar=no,scrollbars=yes,resizable=yes,width=800,height=650'); return false;", type: "button", name: "handbook _button",  class: "btn btn-primary agreement_buttons justify-content-center button_handbook", id:"submit_choice"}Privilege Handbook
            // href="/index2.php?option=com_jumi&amp;fileid=3&amp;Itemid=11" onclick="window.open(this.href,'targetWindow','toolbar=no,location=no,status=no,menubar=no,scrollbars=yes,resizable=yes,width=SomeSize,height=SomeSize'); return false;"

    .container-fluid.bg_none.bg_border.no_padding.margin_bottom_small
      - if @current_module_users.length <= 0
        .container.no_results
          %h.center_element.bigger.text_black No users match your search
      - else
        .container-fluid.bg_none.overflow_style.scroll_down.no_padding.table_div
          %table.table.table-hover.table-dark 
            %tbody
              %tr.medium
                %th.black_text{:colspan => "1", :style => "width: 5%;"} #
                %th.black_text{:colspan => "1", :style => "width: 30%;"} Name
                %th.black_text.center_element{:colspan => "1", :style => "width: 10%;"} Username
                %th.black_text.center_element{:colspan => "1", :style => "width: 20%;"} Email
                %th.black_text.center_element{:colspan => "1", :style => "width: 15%;"} Privilege
                %th.black_text.center_element{:colspan => "4", :style => "width: 20%;"} Action
                = simple_form_for :privilege_form, :id => 'privilege_form' do |f|
                  = f.input :form_username, :as => :hidden, :input_html => {:id => "form_username", :value => "" }
                  - @current_module_users.to_a.each_with_index do |user, index|
                    - if user[:givenname] == nil  
                      - user[:givenname] = ""
                    - if user[:sn] == nil 
                      - user[:sn] = ""
                    - whole_name = user[:givenname] + " " + user[:sn]
                    %tr.small.hover_color
                      %td{:colspan => "1", :style => "width: 5%;"} #{index+1}
                      %td{:colspan => "1", :style => "width: 30%;"} #{whole_name}
                      %td.center_element{:colspan => "1", :style => "width: 10%;"} #{user[:username]}
                      %td.center_element{:colspan => "1", :style => "width: 20%;"} #{user[:email]}
                      %td.center_element{:colspan => "1", :style => "width: 15%;"} #{User.get_module_privilege(user[:id], params[:module_id])}
                      %td.center_element{:colspan => "1", :style => "width: 20%;"} 
                        = f.button :submit, "Change Privilege", name:"privilege_button", class: "btn btn-primary action_buttons justify-content-center small", id:"submit_choice", "data-disable-with" => "Submitting..", onclick: "userFunction('#{user[:username]}')"
    
    .container-fluid.bg_none.row.no_padding.margin_bottom_small
      .container.col-xs-5.col-sm-3.no_padding_left.no_padding_right.padding_right_small
        %button{type: "button", name: "handbook _button",  class: "btn btn-primary agreement_buttons justify-content-center button_groups float_left_override", id:"submit_choice"}Groups
      .container.col-xs-13.col-sm-9.no_padding_left.no_padding_right.padding_right_small
        %a.button{:href => admin_modules_edit_path(:module_id => params[:module_id]), class: "btn btn-primary agreement_buttons justify-content-center button_placeholder float_left_override"}Edit