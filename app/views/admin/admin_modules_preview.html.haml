- content_for :title, "Module Preview"

.container.body_whole_custom
  .container-fluid.bg_none.text_black.margin_top.bigger
    #{@module_info.name} - #{@module_info.code} - Level #{@module_info.level}
    %button.float_right.no_padding.btn.btn-primary.agreement_buttons.justify-content-center.button_go_back_1.medium.button_small{onclick: "location.href='/admin/modules';", type: "button"} Go Back
    %hr.group_line
  .container-fluid.bg_none.text_black
    #{@module_info.description}
    %hr.group_line
  .container-fluid.bg_none
    .container-fluid.bg_none.row.no_padding
      .container-fluid.bg_none.text_black.col-xs-9.col-sm-6.no_padding_right.no_padding.margin_top_none
        %strong
          Module Leaders:
        %br
        %ul
          - if @module_leaders.length != 0
            - for i in 0..(@module_leaders.length-1)
              %li
                #{@module_leaders[i].givenname} #{@module_leaders[i].sn}
      .container-fluid.bg_none.text_black.col-xs-9.col-sm-6.no_padding_left.no_padding.margin_top_none
        %strong
          Teaching assistants:
        %br
        %ul
          - for i in 0..(@teaching_assistants.length-1)
            %li
              #{@teaching_assistants[i].givenname} #{@teaching_assistants[i].sn}
    %hr.group_line
    .container-fluid.bg_none.no_padding.bg_border.margin_bottom_small.bg_white.no_border
      = simple_form_for :search_form do |f|
        .container-fluid.bg_none.no_padding
          %img.search_logo.margin_none{:src => "/assets/search_logo.jpg", :alt => "Search Users"}
        .container-fluid.bg_none.row.no_padding.margin_bottom_none  
          = f.input :form_module_id, :as => :hidden, :input_html => {:id => "form_module_id", :value => params[:module_id] }
          .container.col-xs-6.col-sm-5.no_padding_right.no_padding_left
            = f.input :search_input, as: :string, label: false , required: false
          .container.col-xs-4.col-sm-3.no_padding_left
            = f.button :submit, "Search", name:"search_button", class: "btn btn-primary agreement_buttons justify-content-center button_search_2 float_left", id:"search_choice"
          .container.col-xs-8.col-sm-4.no_padding_left.no_padding_right.padding_right_small
            %button{onclick: "window.open('/module_handbook','Handbook','toolbar=no,location=no,status=no,menubar=no,scrollbars=yes,resizable=yes,width=800,height=650'); return false;", type: "button", name: "handbook _button",  class: "btn btn-primary agreement_buttons justify-content-center button_handbook", id:"submit_choice"}Privilege Handbook
            // href="/index2.php?option=com_jumi&amp;fileid=3&amp;Itemid=11" onclick="window.open(this.href,'targetWindow','toolbar=no,location=no,status=no,menubar=no,scrollbars=yes,resizable=yes,width=SomeSize,height=SomeSize'); return false;"

    .container-fluid.bg_none.bg_border.no_padding.margin_bottom_small
      - if @current_module_users.length <= 0
        .container.no_results
          %h.center_element.bigger.text_black No users match your search
      - else
        .container-fluid.bg_none.overflow_style.scroll_down.no_padding.table_div
          %table.table.table-hover.table-dark
            %thead
              %tr.stick_top
                %th.black_text{:colspan => "1", :style => "width: 5%;"} #
                %th.black_text{:colspan => "1", :style => "width: 30%;"} Name
                %th.black_text.center_element{:colspan => "1", :style => "width: 10%;"} Username
                %th.black_text.center_element{:colspan => "1", :style => "width: 20%;"} Email
                %th.black_text.center_element{:colspan => "1", :style => "width: 15%;"} Role
                %th.black_text.center_element{:colspan => "4", :style => "width: 20%;"} Action 
            %tbody
              - @current_module_users.to_a.each_with_index do |user, index|
                - if user[:givenname] == nil  
                  - user[:givenname] = ""
                - if user[:sn] == nil 
                  - user[:sn] = ""
                - whole_name = user[:givenname] + " " + user[:sn]
                - user_privilege = User.get_module_privilege(params[:module_id], user[:id])
                - if user_privilege.include?("teaching_assistant")
                  - user_privilege = "Teaching Assistant"
                - elsif user_privilege.include?("module_leader")
                  - user_privilege = "Module Leader"
                - elsif user_privilege.include?("student")
                  - user_privilege = "Student"
                %tr.small.hover_color
                  %td{:colspan => "1", :style => "width: 5%;"} #{index+1}
                  %td{:colspan => "1", :style => "width: 30%;"} #{whole_name}
                  %td.center_element{:colspan => "1", :style => "width: 10%;"} #{user[:username]}
                  %td.center_element{:colspan => "1", :style => "width: 20%;"} #{user[:email]}
                  %td.center_element{:colspan => "1", :style => "width: 15%;"} #{user_privilege}
                  %td.center_element{:colspan => "1", :style => "width: 20%;"} 
                    %button{onclick: "popupCenter({url: '/admin/modules/privilege?module_id=#{params[:module_id]}&user_id=#{user[:id]}', title: 'Change Privilege', w: 650, h: 500}); ", type: "submit", name: "privilege_button",  class: "btn btn-primary action_buttons justify-content-center small", id:"submit_choice"}Change Privilege

  .container-fluid.bg_none.row.margin_bottom_small
    .container.col-xs-5.col-sm-3.no_padding_left.no_padding_right.padding_right_small
      %a.button.margin_left_none{:href => admin_modules_groups_path(:module_id => params[:module_id]), type: "button", name: "handbook_button",  class: "btn btn-primary agreement_buttons justify-content-center button_groups float_left_override", id:"handbook_choice"}Groups
    .container.col-xs-13.col-sm-9.no_padding_left.no_padding_right.padding_right_small
      %a.button{:href => admin_modules_edit_path(:module_id => params[:module_id]), class: "btn btn-primary agreement_buttons justify-content-center button_placeholder float_left_override"}Edit/Clone
    .container-fluid.bg_none.no_padding.margin_bottom_small.bg_white.text_black
      %hr.group_line
    .container-fluid.bg_none.no_padding.bg_border.margin_bottom_small.bg_white.text_black.border_none
      #accordion
        .card
          //for loop here 1
          //////////////////////////////////////////////////////////////////////////////////////////////////////// GROUP
          #heading-1.card-header
            %h5.mb-0
              %a.uni_purple.collapsed#a_tag{"aria-controls" => "collapse-1", "aria-expanded" => "false", "data-toggle" => "collapse", href: "#collapse-1", role: "button"}
                Upload a .CSV file            
          #collapse-1.collapse{"aria-labelledby" => "heading-1", "data-parent" => "#accordion"}
            .card-body
              #accordion-1
                .card-body.no_padding_override
                  = form_tag(admin_modules_preview_path(module_id: params[:module_id]), :multipart => true) do
                    .container
                      .input-group
                        .custom-file
                          //%input#customFileInput.custom-file-input{"aria-describedby" => "customFileInput", type: "file"}
                          %input#file#customFileInput.custom-file-input{"aria-describedby" => "customFileInput", name: "file", type: "file"}
                          %label.custom-file-label{for: "customFileInput"} Select file
                      .input-group-append.margin_left_none.special_margin_top
                        %input.btn.btn-primary.agreement_buttons.justify-content-center.float_left_override{"data-disable-with" => "Upload", name: "commit", type: "submit", value: "Upload"}/
                        //%button#customFileInput.btn.btn-primary{type: "button"} Upload
                        //btn btn-primary agreement_buttons justify-content-center button_groups float_left_override
                    :javascript
                      document.querySelector('.custom-file-input').addEventListener('change', function (e) {
                        var name = document.getElementById("customFileInput").files[0].name;
                        var nextSibling = e.target.nextElementSibling
                        nextSibling.innerText = name
                      })


                    -# .container
                    -#   %input#file#customFileInput.custom-file-input{"aria-describedby" => "customFileInput", name: "file", type: "file"}
                    -#   %input{"data-disable-with" => "Upload", name: "commit", type: "submit", value: "Upload"}/
          #heading-2.card-header
            %h5.mb-0
              %a.uni_purple.collapsed#a_tag{"aria-controls" => "collapse-2", "aria-expanded" => "false", "data-toggle" => "collapse", href: "#collapse-2", role: "button"}
                Add individual user
          #collapse-2.collapse{"aria-labelledby" => "heading-2", "data-parent" => "#accordion"}
            .card-body
              #accordion-2
                .card-body
                  //%label.form-label{for: "basic_username"} Username
                  = form_tag admin_modules_preview_path(:module_id => params[:module_id]), :method => :post, :id => 'add_user_form' do
                    //USERNAME
                    .input-group.mb-3
                      %span#basic-addon1.input-group-text @
                      %input.form-control.basic_username{"aria-describedby" => "basic-addon1", "aria-label" => "Username", placeholder: "Username", type: "text", name: "add_username"}
                    -# EMAIL --> Append domain and check if person entered domain by mistake, cut it off and add the sheffield one
                    .input-group.mb-3
                      %input.form-control{"aria-describedby" => "basic-addon2", "aria-label" => "E-mail", placeholder: "E-mail", type: "text", name: "add_email"}
                      %span#basic-addon2.input-group-text @sheffield.ac.uk
                    //First Name AND Last Name
                    .input-group.mb-3
                      %input.form-control{"aria-label" => "First Name", placeholder: "First Name", type: "text", name: "add_first_name"}
                      %input.form-control{"aria-label" => "Last Name", placeholder: "Last Name", type: "text", name: "add_last_name"}
                    //Submit button
                    .container.no_padding
                      %button.margin_left_none.float_left{type: "submit", name: "add_user_button", value: "add_user", class: "btn btn-primary agreement_buttons justify-content-center button_create_user_1 float_left_override", id:"add_user"}Add user

